<% layout("/layouts/boilerplate") %>
<div class="row">
  <div class="col-8 offset-3">
    <br />
    <h3><%= listing.title %></h3>
    <br>
    </div>
    </div> 
    <div class="card col-6 offset-3  show-card listing-card">
      <img
        src="<%= listing.image.url %>"
        alt="<%= listing.title %> "
        class="card-img-top show-img"
        alt="Listing_image"
      />
      <br>
      <div class="card-body">
        <p class="card-text"><b><%=listing.title%></b>
        <br>
        <b>Created By:
        <%=listing.owner.username%></b>
        <br>
        <br>
    <%=listing.description%>
    <br>
    <br>
    <b>
&#8377;<%= listing.price ? listing.price.toLocaleString("en-IN") : "Price not set" %> /night


<br>

<%=listing.location%>
<br>
<%=listing.country%>
<br>


</p>
      </div>
    </div>

  

   

<% if(currUsers && listing.owner._id.equals(currUsers._id)) { %>
    <div class="col-8 offset-3">
    <a href="/listings/<%=listing._id%>/edit"class="btn btn-dark col-2">Edit listing</a>

    <form method="POST" action="/listings/<%=listing._id%>?_method=DELETE">
      <br />
      <button class=" btn add-btn col-2">Delete</button>
    </form>
    </div>
<% } %>



    <br />
<hr>



  <div class="col-8 offset-3 mb-3">
    <% if(currUsers){%>
      <h4>Reveiw listing</h4>
      <form action="/listings/<%= listing._id%>/reviews" method="POST" novalidate class="needs-validation">
        

<div class="rating mb-3 mt-3">
  <label>Rating</label>
  <div class="stars">
    <input type="radio" id="star5" name="review[rating]" value="5">
    <label for="star5">★</label>

    <input type="radio" id="star4" name="review[rating]" value="4">
    <label for="star4">★</label>

    <input type="radio" id="star3" name="review[rating]" value="3">
    <label for="star3">★</label>

    <input type="radio" id="star2" name="review[rating]" value="2">
    <label for="star2">★</label>

    <input type="radio" id="star1" name="review[rating]" value="1">
    <label for="star1">★</label>
  </div>
</div>

<div class="mb-3 mt-3">
  <label for="comment" class="form-label " >Comment </label>
  <textarea name="review[comment]" id="comment" cols="30" rows="5" class="form-control" 
  required></textarea>
  <div class="invalid-feedback">Please add a comment</div>
</div>
<br>
<button class="btn btn-dark" >Submit Review</button>
<%}%>
      </form>


    
      
     
        <p><b>All Reviews</b></p>
<div class="row">
<% for ( review of listing.reviews) { %>
    <div class="card col-5 ms-3 mb-3 ">
      <div class="card-body">
         <h5 class="card-title">
  @<%= review.author ? review.author.username : "Deleted User" %>
</h5>

         <p class="card-text"><%=review.comment%></p>
      </div>
     <form method="POST" action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE">

        <button class="btn btn-sm add-btn">Delete Review</button>
       </form>
      

      <% for (let i = 1; i <= 5; i++) { %>
        <% if (i <= review.rating) { %>
          ★
        <% } else { %>
          ☆
        <% } %>
      <% } %>
        </div>
  <% } %>
  </div>

     
    </div>
  </div>

